<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alke Wallet - Transaction</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Mi CSS -->
    <link rel="stylesheet" href="./css/stylesheet.css" />
  </head>
  <body>
    <!-- ================= HEADER / NAVEGACIÓN ================= -->
    <header class="p-3">
      <nav>
        <ul class="list-inline">
          <!-- Botón Menú -->
          <li class="list-inline-item">
            <button id="btnMenu" class="btn btn-link">Menú</button>
          </li>

          <!-- Botón Depositar -->
          <li class="list-inline-item">
            <button id="btnDepositar" class="btn btn-link">Depositar</button>
          </li>

          <!-- Botón Enviar Dinero -->
          <li class="list-inline-item">
            <button id="btnEnviar" class="btn btn-link">Enviar dinero</button>
          </li>
        </ul>
      </nav>

      <!-- Botón cerrar sesión -->
      <button onclick="cerrarSesion()" class="btn btn-primary">
        Cerrar sesión
      </button>
    </header>

    <main class="container mt-4">
      <h2>Últimos Movimientos</h2>

      <!-- ================= FILTRO ================= -->
      <div class="mb-3">
        <label class="form-label">Filtrar por tipo</label>
        <select id="filtroMovimientos" class="form-control">
          <option value="todos">Todos</option>
          <option value="deposito">Depósitos</option>
          <option value="envio">Envíos</option>
        </select>
      </div>

      <!-- ================= LISTA MOVIMIENTOS ================= -->
      <ul id="listaMovimientos" class="list-group"></ul>

      <br />

      <a href="menu.html" class="btn btn-secondary">
        Volver al Menú Principal
      </a>
    </main>

    <script>
      if (!sessionStorage.getItem("login")) {
        alert("Debe iniciar sesión primero");
        window.location.href = "index.html";
      }
    </script>
    <!-- jQuery PRIMERO -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- script.js DESPUÉS -->
    <script src="./js/script.js"></script>

    <script>
      verificarSesion();

      const lista = document.getElementById("listaMovimientos");
      const movimientos =
        JSON.parse(sessionStorage.getItem("movimientos")) || [];

      if (movimientos.length === 0) {
        lista.innerHTML =
          '<li class="list-group-item">No hay movimientos registrados</li>';
      } else {
        movimientos.forEach((mov) => {
          const li = document.createElement("li");
          li.className = "list-group-item";

          const montoFormato =
            (mov.monto > 0 ? "+" : "") +
            "$" +
            Math.abs(mov.monto).toLocaleString();

          li.innerHTML = `
        <strong>${mov.descripcion}</strong><br>
        <small>${mov.fecha}</small>
        <span class="float-end ${
          mov.monto > 0 ? "text-success" : "text-danger"
        }">
          ${montoFormato}
        </span>
      `;

          lista.appendChild(li);
        });
      }
    </script>
  </body>
</html>
